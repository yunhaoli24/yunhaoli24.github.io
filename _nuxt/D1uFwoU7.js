const e=[[/^(<!--)(.+)(-->)$/,!1],[/^(\/\*)(.+)(\*\/)$/,!1],[/^(\/\/|["'#]|;{1,2}|%{1,2}|--)(.*)$/,!0],[/^(\*)(.+)$/,!0]];function t(e,t,i){let a=[];for(let o of e){if(i===`v3`){let e=o.children.flatMap((e,t)=>{if(e.type!==`element`)return e;let n=e.children[0];if(n.type!==`text`)return e;let i=t===o.children.length-1,a=r(n.value,i);if(!a)return e;let s=n.value.split(/(\s+\/\/)/);if(s.length<=1)return e;let c=[s[0]];for(let e=1;e<s.length;e+=2)c.push(s[e]+(s[e+1]||``));return c=c.filter(Boolean),c.length<=1?e:c.map(t=>({...e,children:[{type:`text`,value:t}]}))});e.length!==o.children.length&&(o.children=e)}let e=o.children,s=e.length-1;i===`v1`?s=0:t&&(s=e.length-2);for(let i=Math.max(s,0);i<e.length;i++){let s=e[i];if(s.type!==`element`)continue;let c=s.children.at(0);if(c?.type!==`text`)continue;let l=i===e.length-1,u=r(c.value,l);if(u)if(t&&!l&&i!==0){let t=n(e[i-1],`{`)&&n(e[i+1],`}`);a.push({info:u,line:o,token:s,isLineCommentOnly:e.length===3&&s.children.length===1,isJsxStyle:t})}else a.push({info:u,line:o,token:s,isLineCommentOnly:e.length===1&&s.children.length===1,isJsxStyle:!1})}}return a}function n(e,t){if(e.type!==`element`)return!1;let n=e.children[0];return n.type===`text`?n.value.trim()===t:!1}function r(t,n){let r=t.trimStart(),i=t.length-r.length;r=r.trimEnd();let a=t.length-r.length-i;for(let[t,o]of e){if(o&&!n)continue;let e=t.exec(r);if(!e)continue;return[` `.repeat(i)+e[1],e[2],e[3]?e[3]+` `.repeat(a):void 0]}}function i(e){let t=e.match(/(?:\/\/|["'#]|;{1,2}|%{1,2}|--)(\s*)$/);return t&&t[1].trim().length===0?e.slice(0,t.index):e}function a(e,n,r,a){return a??=`v3`,{name:e,code(e){let o=e.children.filter(e=>e.type===`element`),s=[];e.data??={};let c=e.data;c._shiki_notation??=t(o,[`jsx`,`tsx`].includes(this.options.lang),a);let l=c._shiki_notation;for(let e of l){if(e.info[1].length===0)continue;let t=o.indexOf(e.line);e.isLineCommentOnly&&a!==`v1`&&t++;let c=!1;if(e.info[1]=e.info[1].replace(n,(...n)=>r.call(this,n,e.line,e.token,o,t)?(c=!0,``):n[0]),!c)continue;a===`v1`&&(e.info[1]=i(e.info[1]));let l=e.info[1].trim().length===0;if(l&&(e.info[1]=``),l&&e.isLineCommentOnly)s.push(e.line);else if(l&&e.isJsxStyle)e.line.children.splice(e.line.children.indexOf(e.token)-1,3);else if(l)e.line.children.splice(e.line.children.indexOf(e.token),1);else{let t=e.token.children[0];t.type===`text`&&(t.value=e.info.join(``))}}for(let t of s){let n=e.children.indexOf(t),r=e.children[n+1],i=1;r?.type===`text`&&r?.value===`
`&&(i=2),e.children.splice(n,i)}}}}function o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}function s(e={},t=`@shikijs/transformers:notation-map`){let{classMap:n={},classActivePre:r=void 0}=e;return a(t,RegExp(`\\s*\\[!code (${Object.keys(n).map(o).join(`|`)})(:\\d+)?\\]`),function([e,t,i=`:1`],a,o,s,c){let l=Number.parseInt(i.slice(1),10);for(let e=c;e<Math.min(c+l,s.length);e++)this.addClassToHast(s[e],n[t]);return r&&this.addClassToHast(this.pre,r),!0},e.matchAlgorithm)}function c(e={}){let{classLineAdd:t=`diff add`,classLineRemove:n=`diff remove`,classActivePre:r=`has-diff`}=e;return s({classMap:{"++":t,"--":n},classActivePre:r,matchAlgorithm:e.matchAlgorithm},`@shikijs/transformers:notation-diff`)}function l(e={}){let{classMap:t={error:[`highlighted`,`error`],warning:[`highlighted`,`warning`]},classActivePre:n=`has-highlighted`}=e;return s({classMap:t,classActivePre:n,matchAlgorithm:e.matchAlgorithm},`@shikijs/transformers:notation-error-level`)}function u(e={}){let{classActiveLine:t=`focused`,classActivePre:n=`has-focused`}=e;return s({classMap:{focus:t},classActivePre:n,matchAlgorithm:e.matchAlgorithm},`@shikijs/transformers:notation-focus`)}function d(e={}){let{classActiveLine:t=`highlighted`,classActivePre:n=`has-highlighted`}=e;return s({classMap:{highlight:t,hl:t},classActivePre:n,matchAlgorithm:e.matchAlgorithm},`@shikijs/transformers:notation-highlight`)}export{a as createCommentNotationTransformer,c as transformerNotationDiff,l as transformerNotationErrorLevel,u as transformerNotationFocus,d as transformerNotationHighlight,s as transformerNotationMap};