const e=(function(e){if(e==null)return a;if(typeof e==`function`)return i(e);if(typeof e==`object`)return Array.isArray(e)?t(e):n(e);if(typeof e==`string`)return r(e);throw Error(`Expected function, string, or object as test`)});function t(t){let n=[],r=-1;for(;++r<t.length;)n[r]=e(t[r]);return i(a);function a(...e){let t=-1;for(;++t<n.length;)if(n[t].apply(this,e))return!0;return!1}}function n(e){let t=e;return i(n);function n(n){let r=n,i;for(i in e)if(r[i]!==t[i])return!1;return!0}}function r(e){return i(t);function t(t){return t&&t.type===e}}function i(e){return t;function t(t,n,r){return!!(o(t)&&e.call(this,t,typeof n==`number`?n:void 0,r||void 0))}}function a(){return!0}function o(e){return typeof e==`object`&&!!e&&`type`in e}function s(e){return e}const c=[],l=!1,u=`skip`;function d(t,n,r,i){let a;typeof n==`function`&&typeof r!=`function`?(i=r,r=n):a=n;let o=e(a),l=i?-1:1;d(t,void 0,[])();function d(e,t,a){let p=e&&typeof e==`object`?e:{};if(typeof p.type==`string`){let t=typeof p.tagName==`string`?p.tagName:typeof p.name==`string`?p.name:void 0;Object.defineProperty(m,`name`,{value:`node (`+s(e.type+(t?`<`+t+`>`:``))+`)`})}return m;function m(){let s=c,p,m,h;if((!n||o(e,t,a[a.length-1]||void 0))&&(s=f(r(e,a)),s[0]===!1))return s;if(`children`in e&&e.children){let t=e;if(t.children&&s[0]!==u)for(m=(i?t.children.length:-1)+l,h=a.concat(t);m>-1&&m<t.children.length;){let e=t.children[m];if(p=d(e,m,h)(),p[0]===!1)return p;m=typeof p[1]==`number`?p[1]:m+l}}return s}}}function f(e){return Array.isArray(e)?e:typeof e==`number`?[!0,e]:e==null?c:[e]}function p(e,t,n,r){let i,a,o;typeof t==`function`&&typeof n!=`function`?(a=void 0,o=t,i=n):(a=t,o=n,i=r),d(e,a,s,i);function s(e,t){let n=t[t.length-1],r=n?n.children.indexOf(e):void 0;return o(e,r,n)}}function m(e){if(typeof e!=`string`)throw TypeError(`Expected a string`);return e.replace(/[|\\{}()[\]^$+*?.]/g,`\\$&`).replace(/-/g,`\\x2d`)}function h(t,n,r){let i=r||{},a=e(i.ignore||[]),o=g(n),s=-1;for(;++s<o.length;)d(t,`text`,c);function c(e,t){let n=-1,r;for(;++n<t.length;){let e=t[n],i=r?r.children:void 0;if(a(e,i?i.indexOf(e):void 0,r))return;r=e}if(r)return l(e,t)}function l(e,t){let n=t[t.length-1],r=o[s][0],i=o[s][1],a=0,c=n.children,l=c.indexOf(e),u=!1,d=[];r.lastIndex=0;let f=r.exec(e.value);for(;f;){let n=f.index,o={index:f.index,input:f.input,stack:[...t,e]},s=i(...f,o);if(typeof s==`string`&&(s=s.length>0?{type:`text`,value:s}:void 0),s===!1?r.lastIndex=n+1:(a!==n&&d.push({type:`text`,value:e.value.slice(a,n)}),Array.isArray(s)?d.push(...s):s&&d.push(s),a=n+f[0].length,u=!0),!r.global)break;f=r.exec(e.value)}return u?(a<e.value.length&&d.push({type:`text`,value:e.value.slice(a)}),n.children.splice(l,1,...d)):d=[e],l+d.length}}function g(e){let t=[];if(!Array.isArray(e))throw TypeError(`Expected find and replace tuple or list of tuples`);let n=!e[0]||Array.isArray(e[0])?e:[e],r=-1;for(;++r<n.length;){let e=n[r];t.push([_(e[0]),v(e[1])])}return t}function _(e){return typeof e==`string`?new RegExp(m(e),`g`):e}function v(e){return typeof e==`function`?e:function(){return e}}function y(e){return`children`in e?x(e):`value`in e?e.value:``}function b(e){return e.type===`text`?e.value:`children`in e?x(e):``}function x(e){let t=-1,n=[];for(;++t<e.children.length;)n[t]=b(e.children[t]);return n.join(``)}function S(e){let t=e;return async e=>{let n=[],r=[];p(e,e=>{let t=e;if(![`pre`,`code`].includes(t.tagName))return!1;let n=t.properties?.language!==void 0&&t.properties?.language!==`text`,r=!!t.properties?.highlights;return n||r},e=>{let i=e,a=typeof i.properties.highlights==`string`?i.properties.highlights.split(/[,\s]+/).map(Number):Array.isArray(i.properties.highlights)?i.properties.highlights.map(Number):[],o=t.highlighter(y(e),i.properties.language,t.theme,{highlights:a.filter(Boolean),meta:i.properties.meta}).then(({tree:e,className:t,style:n,inlineStyle:a})=>{i.properties.className=((i.properties.className||``)+` `+t).trim(),i.properties.style=((i.properties.style||``)+` `+a).trim(),i.children[0]?.tagName===`code`?i.children[0].children=e:i.children=e[0].children||e,n&&r.push(n)});n.push(o)}),n.length&&(await Promise.all(n),e.children.push({type:`element`,tagName:`style`,children:[{type:`text`,value:C(r.join(``))}],properties:{}}))}}const C=e=>{let t=e.split(`}`).filter(e=>!!e.trim()).map(e=>e.trim()+`}`);return Array.from(new Set(t)).join(``)};export{S as b,y as c,h as d,p as e,l as f,u as g,d as h,e as i};